### цель: **как бы ни были заданы `if_offset_hz` и `freq_corr_hz`, в эфир всегда уходит `target_hz`.**
Формула LO остаётся **как есть**:

```
center_hz = target_hz + if_offset_hz + freq_corr_hz
```

Тогда, чтобы RF=target, нужно **цифрово компенсировать** сумму смещений в baseband:

```
digital_shift_hz = -(if_offset_hz + freq_corr_hz)
RF = center_hz + digital_shift_hz = target_hz
```

**краткое ТЗ, где править**:

# 1) UI (`page_406.py`)

* Ничего не менять. Оставить расчёт `center_hz = target_hz + if_offset_hz + freq_corr_hz`.
* Убедиться, что в профиль передаются три поля: `target_hz`, `if_offset_hz`, `freq_corr_hz`.

# 2) Бэкенд TX (`hackrf.py`) — **добавить цифровой сдвиг**

* Перед квантованием cf32→sc8 домиксовать IQ на частоту:

  ```
  digital_shift_hz = -(if_offset_hz + freq_corr_hz)
  iq *= exp(j*2π*digital_shift_hz*t)
  ```

  где `t = np.arange(len(iq))/fs_tx`.
* Делать это **один раз** для каждого кадра (в finite и loop режимах — до конкатенации/запуска `-R`).
* Логи (обязательно):

  * `target=..., if=..., corr=..., center=..., digital_shift=...`
  * Это позволит мгновенно проверить инвариант `center + digital_shift == target`.

# 3) Генератор (`psk406.py` / `wave_engine.py`)

* Никаких сдвигов от `if_offset_hz`/`freq_corr_hz` **не делать** (оставить чистый baseband=0 Гц).
* (Опционально) поддержать отдельный параметр `baseband_shift_hz` для других задач, но **не связывать его** с `if_offset_hz`/`freq_corr_hz`.

# 4) Смоук-кейсы (проверка по логам)

* A: `target=406037000, if=-37000, corr=0`

  * `center=406000000`, `digital_shift=+37000` → RF=406037000 ✅
* B: `target=406037000, if=+37000, corr=0`

  * `center=406074000`, `digital_shift=−37000` → RF=406037000 ✅
* C: `target=406037000, if=0, corr=+200`

  * `center=406037200`, `digital_shift=−200` → RF=406037000 ✅

Так вы сохраняете привычную и «наглядную» формулу LO в UI, а инвариант **«в эфир всегда target_hz»** обеспечивается одной строкой домикса в бэкенде.
