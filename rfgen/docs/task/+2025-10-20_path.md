### пройтись по проекту, выровнять пути и централизовать их.

# Цель

Все артефакты должны жить **внутри пакета**:

* профили → `<repo_root>/rfgen/profiles/`
* выходные файлы (IQ) → `<repo_root>/rfgen/out/`
* (временные, логи — по желанию) → `<repo_root>/rfgen/logs/`

# Что сделать (пошагово)

## 1) Ввести единый модуль путей

**Новый файл:** `rfgen/utils/paths.py`

```python
from pathlib import Path

def pkg_root() -> Path:
    # любой модуль внутри пакета: rfgen/<...>/<this_file>.py  → parents[1] == rfgen/
    return Path(__file__).resolve().parents[1]

def profiles_dir() -> Path:
    p = pkg_root() / "profiles"
    p.mkdir(parents=True, exist_ok=True); return p

def out_dir() -> Path:
    p = pkg_root() / "out"
    p.mkdir(parents=True, exist_ok=True); return p

def logs_dir() -> Path:
    p = pkg_root() / "logs"
    p.mkdir(parents=True, exist_ok=True); return p
```

## 2) Починить сохранение/загрузку в UI (PySide6)

**Файл:** `rfgen/ui_qt/pages/page_quick.py`

* Заменить прямые вычисления через `Path(__file__).resolve().parents[...]` на импорт из `utils.paths`:

```python
from ...utils.paths import profiles_dir, out_dir
# ...
# сохранение профиля:
path = (profiles_dir() / f"{prof['name']}.json")
# генерация IQ:
out_path = (out_dir() / "quick_tx_frame.sc8")  # реальное имя формирует backend
```

* Исправить ВСЕ места, где сейчас используется `parents[3]`/`parents[2]`. Должно остаться **только** через `profiles_dir()` и `out_dir()`.

## 3) Backend FileOut → использовать out_dir()

**Файл:** `rfgen/backends/fileout.py`

* Конструктор может принимать `out_dir: Path | None = None`, по умолчанию брать `utils.paths.out_dir()`.

```python
from ..utils.paths import out_dir as _out_dir

class FileOutBackend:
    def __init__(self, out_dir=None):
        self.out_dir = Path(out_dir) if out_dir else _out_dir()
        self.out_dir.mkdir(parents=True, exist_ok=True)
```

## 4) Места генерации IQ в UI/CLI

* **UI** уже в п.2 переключим на `FileOutBackend()` без передачи пути.
* **Файл:** `rfgen/cli/rfgen_cli.py`

  * если сейчас принимает `--outdir`, оставь, но **по умолчанию** используй `utils.paths.out_dir()`.

```python
from ..utils.paths import out_dir as default_out_dir
# ...
outdir = Path(args.outdir) if args.outdir else default_out_dir()
```

## 5) Все обращения к профилям

* Поиск: `grep -R "profiles" rfgen/` и `grep -R "out/" rfgen/`.
* Везде заменить руками вычисленные пути на вызовы `profiles_dir()`/`out_dir()`.
* Если есть страница «Profiles», список файлов читать только из `profiles_dir()`.

## 6) Миграция старых папок (одноразово, безопасно)

**Новый модуль:** `rfgen/utils/migrate.py`

```python
from pathlib import Path
from .paths import pkg_root, profiles_dir

def migrate_legacy_profiles() -> int:
    moved = 0
    legacy = pkg_root().parent / "profiles"  # <repo_root>/profiles/
    if legacy.exists():
        for f in legacy.glob("*.json"):
            dst = profiles_dir() / f.name
            if dst.exists():
                dst = profiles_dir() / (f.stem + "_migrated.json")
            f.replace(dst)
            moved += 1
        try: legacy.rmdir()
        except OSError: pass
    return moved
```

* В `page_quick.py` при старте страницы (или при первом `Save/Load`) вызвать `migrate_legacy_profiles()` и показать статус, если что-то перенеслось.

## 7) Обновить `.gitignore` (в репо)

Убедиться, что есть строки:

```
/rfgen/profiles/*.json
/rfgen/out/*
/rfgen/logs/*
```

## 8) Мини-тесты (опционально, но полезно)

**Файл:** `tests/test_paths.py`

```python
from rfgen.utils.paths import pkg_root, profiles_dir, out_dir
def test_paths_exist():
    assert pkg_root().name == "rfgen"
    assert profiles_dir().exists()
    assert out_dir().exists()
```

**Файл:** `tests/test_profile_io.py`

* Сохранить фейковый профиль в `profiles_dir()` и проверить, что файл там появился.
* Загрузка из `profiles_dir()` корректно парсит JSON.

## 9) Удалить/перенести мусорные корневые папки

* Если найдутся `<repo_root>/profiles` или `<repo_root>/out`, не используем их.
* Сделать в README заметку, что «правильные» каталоги внутри пакета.

# Поисковые шаблоны для ревью

В корне репо:

```
grep -R "parents\\[" rfgen/
grep -R "profiles" rfgen/
grep -R "out/" rfgen/
grep -R "Path(__file__)" rfgen/
```

Всё, что строит путь руками — заменить на `utils.paths`.

# Критерии приёмки

* Сохранение профилей идёт **только** в `rfgen/profiles/`.
* Генерация IQ — **только** в `rfgen/out/`.
* UI «Save as Profile…» и потенциальная «Load» открывают **эти** каталоги по умолчанию.
* При наличии старой `/<repo_root>/profiles/*.json` — файлы мигрируются в `rfgen/profiles/` (без перезаписей).
* Нет оставшихся обращений к `parents[3]`/жёстких путей; всё через `utils.paths`.

Если надо — дописать мне «сделай патч», и я сразу выдам готовые диффы для этих файлов.
