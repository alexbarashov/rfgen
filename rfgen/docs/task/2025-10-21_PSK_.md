### ТЗ, чтобы сделать **единый источник правды** для PSK-406.

# Цель

Оставить **одну** реализацию формирования кадра PSK-406 и исключить расхождения.
Выбираем `psk406.py` как единственный генератор, а `wave_engine.py` лишь делегирует вызов.

# Изменения по файлам

## 1) `psk406.py` — единый генератор

* Экспортировать одну функцию (стабильный API):

  ```python
  def generate_psk406(
      *,
      fs: float,
      hex_message: str,
      bitrate_bps: float = 400.0,
      phase_rad: float = 1.1,
      front_frac: float = 0.08,     # доля полубита (0..0.49)
      pre_silence_s: float = 0.025,
      carrier_s: float = 0.16,
      post_silence_s: float = 0.025,
      if_offset_hz: float = 0.0,    # цифровой сдвиг (+IF)
      manchester_polarity: str = "LH_for_0",
      normalize_before_noise: bool = True,
      add_noise_snr_db: float | None = None,
      meta: bool = True,
  ) -> tuple[np.ndarray, dict]  # (iq_cf32, meta)
  ```
* Поведение:

  * `front_frac` конвертировать в сэмплы с защитой `< 0.5 полубита`.
  * Нормализация **до** шума при `normalize_before_noise=True`.
  * Если `if_offset_hz != 0`: умножать на `exp(j2π f_if t)`.
  * `meta` возвращает длительности, число сэмплов/битов, peak/RMS.
* Исключения:

  * Пустой `hex_message`, неверная `manchester_polarity`, `front_frac` вне (0..0.49), `fs<=0`, `bitrate_bps<=0` — бросать `ValueError` с коротким текстом.

## 2) `wave_engine.py` — только делегирование

* Внутри `build_iq(profile, ...)` убрать локальную реализацию PSK-406.
* Добавить диспетчер:

  ```python
  if profile["standard"] in ("psk406","c406"):
      iq, meta = psk406.generate_psk406(
          fs=profile["device"]["fs_tx"],
          hex_message=profile["standard_params"]["hex_message"],
          bitrate_bps=profile["standard_params"].get("bitrate_bps", 400.0),
          phase_rad=profile["standard_params"].get("phase_rad", 1.1),
          front_frac=profile["standard_params"].get("front_frac", 0.08),
          pre_silence_s=profile["standard_params"].get("pre_silence_s", 0.025),
          carrier_s=profile["standard_params"].get("carrier_s", 0.16),
          post_silence_s=profile["standard_params"].get("post_silence_s", 0.025),
          if_offset_hz=profile["device"].get("if_offset_hz", 0.0),
          manchester_polarity=profile["standard_params"].get("manchester_polarity","LH_for_0"),
          normalize_before_noise=profile["standard_params"].get("normalize_before_noise", True),
          add_noise_snr_db=profile["standard_params"].get("snr_db"),
          meta=True,
      )
      return iq, {"psk406": meta}
  ```
* Не дублировать вычисления фронтов, манчестера, тишин и IF — всё внутри `psk406.py`.

## 3) `resample.py` / бэкенды

* Ресэмплинг, запись cf32→sc8, паузы/повторы — **вне** `psk406.py` (не смешивать уровни).
* Контракт IF: **LO = target + IF**, цифровой сдвиг **+IF** в генераторе. Зафиксировать это в одном месте (README/комментарий) и валидацию параметров при запуске.


# План внедрения

1. Перенести актуальную логику в `psk406.py` по указанному API.
2. Вычистить PSK-406 из `wave_engine.py`, оставить делегирование.
3. Прогнать smoke-тест (fileout, затем HackRF) и зафиксировать эталоны.
