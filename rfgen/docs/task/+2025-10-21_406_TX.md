Нашёл сразу три «критичных» узла, из-за которых 406-передача объективно не заработает в текущей сборке. Кратко и по делу:

# 1) Генератор сигнала: в `wave_engine.py` нет PSK-406

В вашем «двигателе волн» реализованы только `AM/PM/FM` и `none`. Функции, которая строит BPSK-манчестер 400 бод (полубиты, ±φ, плавные фронты), нет — следовательно, на вход бэкенда попадает **не тот сигнал** (или просто CW). Нужно добавить отдельный путь `mod == "psk406"` с генерацией манчестер-полубитов и, опционально, цифровым домиксованием на `if_offset_hz`. 

Что исправить быстро:

* В `build_iq(...)` добавить ветку `elif mod == "psk406":` и вызвать ваш генератор 406 (или портировать логику из рабочего модуля).
* Либо сделать отдельную функцию `build_psk406(profile, ...)` и звать её из UI/профиля при `standard:"psk406"`.

# 2) Ресэмплер пустой

`resample.py` сейчас заглушка (`pass`). Если где-то в пайплайне включён пересэмплинг (разные `fs_gen`/`fs_tx`), вы отдаёте в бэкенд либо пустой буфер, либо ничего не меняете — типичная причина «тишины» в эфире. Минимально — поставьте рабочий ресэмплер (даже простую линейную интерполяцию), и обязательно валидируйте длину результата (`len(out) > 0`). 

# 3) Вызов `hackrf_transfer`: не дожимаете ключи/формат

Ваш бэкенд формирует команду без ряда практичных опций и **не контролирует формат файла**: `hackrf_transfer` по умолчанию ждёт **интерливнутый sc8**, а не `cf32`. Если в `iq_path` окажется float32-baseband — в эфир уйдёт мусор/тишина. Плюс, для надёжного TX обычно включают PA (`-a 1`). Сейчас команда:
`hackrf_transfer -t <file> -f <Hz> -s <Fs> -x <gain> -R` — без `-a 1`, без проверки типа данных. 

Что обязательно добавить:

* Конверсию **cf32 → sc8** (масштабирование до |I|,|Q| ≤ 127, клип-контроль) перед запуском процесса.
* Флаг **`-a 1`** (включить PA) — иначе уровень может быть слишком малым.
* Журналировать фактическую строку запуска и первые байты файла для верификации.

---

## Мини-чек-лист, чтобы оживить TX-406 сегодня

1. **Сделать генерацию PSK-406 в `wave_engine`**
   Добавьте `elif mod == "psk406": iq = build_psk406(profile, frame_s)` с:

   * скорость 400 бод (2500 сэмплов/бит при 1 MS/s), манчестер LH/HL как параметр,
   * уровни фазы ±1.1 рад,
   * «фронт» как доля полубита (напр. 8–12 %), конвертация в сэмплы внутри,
   * опциональный цифровой сдвиг на `if_offset_hz` (exp(j·2π·f_if·t)), если вы держите LO=target+IF. 

2. **Заполнить `resample(...)`**
   Реализуйте хотя бы линейный ресэмплинг с проверками:

   * если `fs_in == fs_out` → вернуть копию,
   * иначе интерполяция; при `len(out) < 8` — явная ошибка «Empty after resample». 

3. **Исправить запуск HackRF**
   Перед `run_loop(...)` конвертируйте временный IQ-файл в **sc8** и запускайте:

   ```
   hackrf_transfer -t out.sc8 -f <center_hz> -s <fs_tx> -x <gain> -a 1 -R
   ```

   Плюс лог: фактическая команда, размер файла, первые 64 байта (hex) — в ваш лог-файл, который вы уже заводите в классе. 

4. **IF-схема — единый контракт**
   Решите, где домикс:

   * либо «LO = target + IF», а в генерируемом IQ всегда экспонента **+IF** (цифровой тон) — тогда на выходе антенны будет `target`;
   * либо «LO = target», а IQ — **чистый бейсбенд** без тона.
     Сейчас `build_cw(...)` умеет дать тон на `if_offset_hz`, но для 406 его нет — добавьте в PSK-генератор те же 2 строки с exp(j·2π·f_if·t). 

---

## Быстрые «предохранители», чтобы ловить баги сразу

* После генерации (и после ресэмпла) логируйте: длину, RMS и peak IQ (до квантования). Если **peak≈0** — сигнал нулевой уже на этом этапе.
* Перед запуском `hackrf_transfer` — проверка **размера sc8-файла** (> 0), печать первых 32–64 байт в лог. 
* В логе бэкенда держите одну строку с **полной командой** и `PID`, вы это уже делаете — оставьте, это помогает. 

Кратко:

* `wave_engine.py`: добавить `build_psk406(...)` (манчестер + фронт + опц. IF-сдвиг) и ветку в `build_iq`.
* `resample.py`: простая реализация + тест «круговой» идентичности.
* `hackrf.py`: sc8-квантование (амплитуда ≤0.95), `-a 1`, и явные ошибки при пустом файле.

С этими тремя фиксам TX-406 обычно «встаёт» сразу.

Для примера используй проект :
C:\work\TesterPi\beacon406\gen
ui_psk406_tx.py
psk406_msg_gen.py
backend_hackrf_tx.py

